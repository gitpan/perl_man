.rn '' }`
''' $RCSfile$$Revision$$Date$
'''
''' $Log$
'''
.de Sh
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp
.if t .sp .5v
.if n .sp
..
.de Ip
.br
.ie \\n(.$>=3 .ne \\$3
.el .ne 3
.IP "\\$1" \\$2
..
.de Vb
.ft CW
.nf
.ne \\$1
..
.de Ve
.ft R

.fi
..
'''
'''
'''     Set up \*(-- to give an unbreakable dash;
'''     string Tr holds user defined translation string.
'''     Bell System Logo is used as a dummy character.
'''
.tr \(*W-|\(bv\*(Tr
.ie n \{\
.ds -- \(*W-
.ds PI pi
.if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\" diablo 12 pitch
.ds L" ""
.ds R" ""
'''   \*(M", \*(S", \*(N" and \*(T" are the equivalent of
'''   \*(L" and \*(R", except that they are used on ".xx" lines,
'''   such as .IP and .SH, which do another additional levels of
'''   double-quote interpretation
.ds M" """
.ds S" """
.ds N" """""
.ds T" """""
.ds L' '
.ds R' '
.ds M' '
.ds S' '
.ds N' '
.ds T' '
'br\}
.el\{\
.ds -- \(em\|
.tr \*(Tr
.ds L" ``
.ds R" ''
.ds M" ``
.ds S" ''
.ds N" ``
.ds T" ''
.ds L' `
.ds R' '
.ds M' `
.ds S' '
.ds N' `
.ds T' '
.ds PI \(*p
'br\}
.\"	If the F register is turned on, we'll generate
.\"	index entries out stderr for the following things:
.\"		TH	Title 
.\"		SH	Header
.\"		Sh	Subsection 
.\"		Ip	Item
.\"		X<>	Xref  (embedded
.\"	Of course, you have to process the output yourself
.\"	in some meaninful fashion.
.if \nF \{
.de IX
.tm Index:\\$1\t\\n%\t"\\$2"
..
.nr % 0
.rr F
.\}
.TH PUMPKIN 1 "perl 5.005, patch 52" "22/Jul/98" "Perl Programmers Reference Guide"
.UC
.if n .hy 0
.if n .na
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.de CQ          \" put $1 in typewriter font
.ft CW
'if n "\c
'if t \\&\\$1\c
'if n \\&\\$1\c
'if n \&"
\\&\\$2 \\$3 \\$4 \\$5 \\$6 \\$7
'.ft R
..
.\" @(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2
.	\" AM - accent mark definitions
.bd B 3
.	\" fudge factors for nroff and troff
.if n \{\
.	ds #H 0
.	ds #V .8m
.	ds #F .3m
.	ds #[ \f1
.	ds #] \fP
.\}
.if t \{\
.	ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.	ds #V .6m
.	ds #F 0
.	ds #[ \&
.	ds #] \&
.\}
.	\" simple accents for nroff and troff
.if n \{\
.	ds ' \&
.	ds ` \&
.	ds ^ \&
.	ds , \&
.	ds ~ ~
.	ds ? ?
.	ds ! !
.	ds /
.	ds q
.\}
.if t \{\
.	ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.	ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.	ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.	ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.	ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.	ds ? \s-2c\h'-\w'c'u*7/10'\u\h'\*(#H'\zi\d\s+2\h'\w'c'u*8/10'
.	ds ! \s-2\(or\s+2\h'-\w'\(or'u'\v'-.8m'.\v'.8m'
.	ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.	ds q o\h'-\w'o'u*8/10'\s-4\v'.4m'\z\(*i\v'-.4m'\s+4\h'\w'o'u*8/10'
.\}
.	\" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds v \\k:\h'-(\\n(.wu*9/10-\*(#H)'\v'-\*(#V'\*(#[\s-4v\s0\v'\*(#V'\h'|\\n:u'\*(#]
.ds _ \\k:\h'-(\\n(.wu*9/10-\*(#H+(\*(#F*2/3))'\v'-.4m'\z\(hy\v'.4m'\h'|\\n:u'
.ds . \\k:\h'-(\\n(.wu*8/10)'\v'\*(#V*4/10'\z.\v'-\*(#V*4/10'\h'|\\n:u'
.ds 3 \*(#[\v'.2m'\s-2\&3\s0\v'-.2m'\*(#]
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.ds oe o\h'-(\w'o'u*4/10)'e
.ds Oe O\h'-(\w'O'u*4/10)'E
.	\" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.	\" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.	ds : e
.	ds 8 ss
.	ds v \h'-1'\o'\(aa\(ga'
.	ds _ \h'-1'^
.	ds . \h'-1'.
.	ds 3 3
.	ds o a
.	ds d- d\h'-1'\(ga
.	ds D- D\h'-1'\(hy
.	ds th \o'bp'
.	ds Th \o'LP'
.	ds ae ae
.	ds Ae AE
.	ds oe oe
.	ds Oe OE
.\}
.rm #[ #] #H #V #F C
.SH "NAME"
Pumpkin \- Notes on handling the Perl Patch Pumpkin
.SH "SYNOPSIS"
There is no simple synopsis, yet.
.SH "DESCRIPTION"
This document attempts to begin to describe some of the
considerations involved in patching and maintaining perl.
.PP
This document is still under construction, and still subject to
significant changes.  Still, I hope parts of it will be useful,
so I'm releasing it even though it's not done.
.PP
For the most part, it's a collection of anecdotal information that
already assumes some familiarity with the Perl sources.  I really need
an introductory section that describes the organization of the sources
and all the various auxiliary files that are part of the distribution.
.SH "Where Do I Get Perl Sources and Related Material?"
The Comprehensive Perl Archive Network (or CPAN) is the place to go.
There are many mirrors, but the easiest thing to use is probably
http://www.perl.com/CPAN/README.html , which automatically points you to a
mirror site \*(L"close\*(R" to you.
.Sh "Perl5-porters mailing list"
The mailing list perl5-porters@perl.org
is the main group working with the development of perl.  If you're
interested in all the latest developments, you should definitely
subscribe.  The list is high volume, but generally has a
fairly low noise level.
.PP
Subscribe by sending the message (in the body of your letter)
.PP
.Vb 1
\&        subscribe perl5-porters
.Ve
to perl5-porters-request@perl.org .
.PP
Archives of the list are held at:
.PP
.Vb 1
\&    http://www.rosat.mpe-garching.mpg.de/mailing-lists/perl-porters/
.Ve
.SH "How are Perl Releases Numbered?"
Perl version numbers are floating point numbers, such as 5.004.
(Observations about the imprecision of floating point numbers for
representing reality probably have more relevance than you might
imagine :\-) The major version number is 5 and the \*(L'004\*(R' is the
patchlevel.  (Questions such as whether or not \*(L'004\*(R' is really a minor
version number can safely be ignored.:)
.PP
The version number is available as the magic variable $],
and can be used in comparisons, e.g.
.PP
.Vb 1
\&        print "You've got an old perl\en" if $] < 5.002;
.Ve
You can also require particular version (or later) with
.PP
.Vb 1
\&        use 5.002;
.Ve
At some point in the future, we may need to decide what to call the
next big revision.  In the .package file used by metaconfig to
generate Configure, there are two variables that might be relevant:
\f(CW$baserev\fR=5.0 and \f(CW$package\fR=perl5.   At various times, I have suggested
we might change them to \f(CW$baserev\fR=5.1 and \f(CW$package\fR=perl5.1 if want
to signify a fairly major update.  Or, we might want to jump to perl6.
Let's worry about that problem when we get there.
.Sh "Subversions"
In addition, there may be \*(L"developer\*(R" sub-versions available.  These
are not official releases.  They may contain unstable experimental
features, and are subject to rapid change.  Such developer
sub-versions are numbered with sub-version numbers.  For example,
version 5.003_04 is the 4'th developer version built on top of
5.003.  It might include the _01, _02, and _03 changes, but it
also might not.  Sub-versions are allowed to be subversive. (But see
the next section for recent changes.)
.PP
These sub-versions can also be used as floating point numbers, so
you can do things such as
.PP
.Vb 1
\&        print "You've got an unstable perl\en" if $] == 5.00303;
.Ve
You can also require particular version (or later) with
.PP
.Vb 1
\&        use 5.003_03;    # the "_" is optional
.Ve
Sub-versions produced by the members of perl5-porters are usually
available on \s-1CPAN\s0 in the \fIsrc/5.0/unsupported\fR directory.
.Sh "Maintenance and Development Subversions"
As an experiment, starting with version 5.004, subversions _01 through
_49 will be reserved for bug-fix maintenance releases, and subversions
_50 through _99 will be available for unstable development versions.
.PP
The separate bug-fix track is being established to allow us an easy
way to distribute important bug fixes without waiting for the
developers to untangle all the other problems in the current
developer's release.
.PP
Trial releases of bug-fix maintenance releases are announced on
perl5-porters. Trial releases use the new subversion number (to avoid
testers installing it over the previous release) and include a \*(L'local
patch\*(R' entry in patchlevel.h.
.PP
Watch for announcements of maintenance subversions in
comp.lang.perl.announce.
.PP
The first rule of maintenance work is \*(L"First, do no harm.\*(R"
.Sh "Why such a complicated scheme?"
Two reasons, really.  At least.
.PP
First, we need some way to identify and release collections of patches
that are known to have new features that need testing and exploration.  The
subversion scheme does that nicely while fitting into the
\f(CWuse 5.004;\fR mold.
.PP
Second, since most of the folks who help maintain perl do so on a
free-time voluntary basis, perl development does not proceed at a
precise pace, though it always seems to be moving ahead quickly.
We needed some way to pass around the \*(L"patch pumpkin\*(R" to allow
different people chances to work on different aspects of the
distribution without getting in each other's way.  It wouldn't be
constructive to have multiple people working on incompatible
implementations of the same idea.  Instead what was needed was
some kind of \*(L"baton\*(R" or \*(L"token\*(R" to pass around so everyone knew
whose turn was next.
.Sh "Why is it called the patch pumpkin?"
Chip Salzenberg gets credit for that, with a nod to his cow orker,
David Croy.  We had passed around various names (baton, token, hot
potato) but none caught on.  Then, Chip asked:
.PP
[begin quote]
.PP
.Vb 1
\&   Who has the patch pumpkin?
.Ve
To explain:  David Croy once told me once that at a previous job,
there was one tape drive and multiple systems that used it for backups.
But instead of some high-tech exclusion software, they used a low-tech
method to prevent multiple simultaneous backups: a stuffed pumpkin.
No one was allowed to make backups unless they had the \*(L"backup pumpkin\*(R".
.PP
[end quote]
.PP
The name has stuck.
.SH "Philosophical Issues in Patching Perl"
There are no absolute rules, but there are some general guidelines I
have tried to follow as I apply patches to the perl sources.
(This section is still under construction.)
.Sh "Solve problems as generally as possible"
Never implement a specific restricted solution to a problem when you
can solve the same problem in a more general, flexible way.
.PP
For example, for dynamic loading to work on some \s-1SVR4\s0 systems, we had
to build a shared libperl.so library.  In order to build \*(L"\s-1FAT\s0\*(R" binaries
on NeXT 4.0 systems, we had to build a special libperl library.  Rather
than continuing to build a contorted nest of special cases, I
generalized the process of building libperl so that NeXT and \s-1SVR4\s0 users
could still get their work done, but others could build a shared
libperl if they wanted to as well.
.Sh "Seek consensus on major changes"
If you are making big changes, don't do it in secret.  Discuss the
ideas in advance on perl5-porters.
.Sh "Keep the documentation up-to-date"
If your changes may affect how users use perl, then check to be sure
that the documentation is in sync with your changes.  Be sure to
check all the files \fIpod/*.pod\fR and also the \fI\s-1INSTALL\s0\fR document.
.PP
Consider writing the appropriate documentation first and then
implementing your change to correspond to the documentation.
.Sh "Avoid machine-specific #ifdef's"
To the extent reasonable, try to avoid machine-specific #ifdef's in
the sources.  Instead, use feature-specific #ifdef's.  The reason is
that the machine-specific #ifdef's may not be valid across major
releases of the operating system.  Further, the feature-specific tests
may help out folks on another platform who have the same problem.
.Sh "Allow for lots of testing"
We should never release a main version without testing it as a
subversion first.
.Sh "Test popular applications and modules."
We should never release a main version without testing whether or not
it breaks various popular modules and applications.  A partial list of
such things would include majordomo, metaconfig, apache, Tk, \s-1CGI\s0,
libnet, and libwww, to name just a few.  Of course it's quite possible
that some of those things will be just plain broken and need to be fixed,
but, in general, we ought to try to avoid breaking widely-installed
things.
.Sh "Automate generation of derivative files"
The \fIembed.h\fR, \fIkeywords.h\fR, \fIopcode.h\fR, and \fIperltoc.pod\fR files
are all automatically generated by perl scripts.  In general, don't
patch these directly; patch the data files instead.
.PP
\fIConfigure\fR and \fIconfig_h.\s-1SH\s0\fR are also automatically generated by
\fBmetaconfig\fR.  In general, you should patch the metaconfig units
instead of patching these files directly.  However, very minor changes to
\fIConfigure\fR may be made in between major sync-ups with the metaconfig
units, which tends to be complicated operations.  But be careful, this
can quickly spiral out of control.  Running metaconfig is not really
hard.
.PP
Finally, the sample files in the \fIPorting/\fR subdirectory are
generated automatically by the script \fIU/mksample\fR included 
with the metaconfig units.  See the section on \fIrun metaconfig\fR below for
information on obtaining the metaconfig units.
.SH "How to Make a Distribution"
There really ought to be a \*(L'make dist\*(R' target, but there isn't.
The \*(L'dist\*(R' suite of tools also contains a number of tools that I haven't
learned how to use yet.  Some of them may make this all a bit easier.
.PP
Here are the steps I go through to prepare a patch & distribution.
.PP
Lots of it could doubtless be automated but isn't.  The Porting/makerel
(make release) perl script does now help automate some parts of it.
.Sh "Announce your intentions"
First, you should volunteer out loud to take the patch pumpkin.  It's
generally counter-productive to have multiple people working in secret
on the same thing.
.PP
At the same time, announce what you plan to do with the patch pumpkin,
to allow folks a chance to object or suggest alternatives, or do it for
you.  Naturally, the patch pumpkin holder ought to incorporate various
bug fixes and documentation improvements that are posted while he or
she has the pumpkin, but there might also be larger issues at stake.
.PP
One of the precepts of the subversion idea is that we shouldn't give
the patch pumpkin to anyone unless we have some idea what he or she
is going to do with it.
.Sh "refresh pod/perltoc.pod"
Presumably, you have done a full \f(CWmake\fR in your working source
directory.  Before you \f(CWmake spotless\fR (if you do), and if you have
changed any documentation in any module or pod file, change to the
\fIpod\fR directory and run \f(CWmake toc\fR.
.Sh "run installhtml to check the validity of the pod files"
.Sh "update patchlevel.h"
Don't be shy about using the subversion number, even for a relatively
modest patch.  We've never even come close to using all 99 subversions,
and it's better to have a distinctive number for your patch.  If you
need feedback on your patch, go ahead and issue it and promise to
incorporate that feedback quickly (e.g. within 1 week) and send out a
second patch.
.Sh "run metaconfig"
If you need to make changes to Configure or config_h.\s-1SH\s0, it may be best to
change the appropriate metaconfig units instead, and regenerate Configure.
.PP
.Vb 1
\&        metaconfig -m
.Ve
will regenerate Configure and config_h.\s-1SH\s0.  Much more information
on obtaining and running metaconfig is in the \fIU/\s-1README\s0\fR file
that comes with Perl's metaconfig units.  Perl's metaconfig units
should be available on \s-1CPAN\s0.  A set of units that will work with
perl5.005 is in the file \fImc_units-5.005_00-01.tar.gz\fR under
http://www.perl.com/\s-1CPAN/\s0authors/id/\s-1ANDYD\s0/ .  The mc_units tar file
should be unpacked in your main perl source directory.  Note: those
units were for use with 5.005.  There may have been changes since then.
Check for later versions or contact perl5-porters@perl.org to obtain a
pointer to the current version.
.PP
Alternatively, do consider if the \fI*ish.h\fR files might be a better
place for your changes.
.Sh "\s-1MANIFEST\s0"
Make sure the \s-1MANIFEST\s0 is up-to-date.  You can use dist's \fBmanicheck\fR
program for this.  You can also use
.PP
.Vb 1
\&    perl -w -MExtUtils::Manifest=fullcheck -e fullcheck
.Ve
Both commands will also list extra files in the directory that are not
listed in \s-1MANIFEST\s0.
.PP
The \s-1MANIFEST\s0 is normally sorted.
.PP
If you are using metaconfig to regenerate Configure, then you should note
that metaconfig actually uses \s-1MANIFEST\s0.new, so you want to be sure
\s-1MANIFEST\s0.new is up-to-date too.  I haven't found the \s-1MANIFEST/MANIFEST\s0.new
distinction particularly useful, but that's probably because I still haven't
learned how to use the full suite of tools in the dist distribution.
.Sh "Check permissions"
All the tests in the t/ directory ought to be executable.  The
main makefile used to do a \*(L'chmod t/*/*.t\*(R', but that resulted in
a self-modifying distribution\*(--something some users would strongly
prefer to avoid.  The \fIt/\s-1TEST\s0\fR script will check for this
and do the chmod if needed, but the tests still ought to be
executable.
.PP
In all, the following files should probably be executable:
.PP
.Vb 16
\&    Configure
\&    configpm
\&    configure.gnu
\&    embed.pl
\&    installperl
\&    installman
\&    keywords.pl
\&    myconfig
\&    opcode.pl
\&    perly.fixer
\&    t/TEST
\&    t/*/*.t
\&    *.SH
\&    vms/ext/Stdio/test.pl
\&    vms/ext/filespec.t
\&    x2p/*.SH
.Ve
Other things ought to be readable, at least :\-).
.PP
Probably, the permissions for the files could be encoded in \s-1MANIFEST\s0
somehow, but I'm reluctant to change \s-1MANIFEST\s0 itself because that
could break old scripts that use \s-1MANIFEST\s0.
.PP
I seem to recall that some \s-1SVR3\s0 systems kept some sort of file that listed
permissions for system files; something like that might be appropriate.
.Sh "Run Configure"
This will build a config.sh and config.h.  You can skip this if you haven't
changed Configure or config_h.\s-1SH\s0 at all.  I use the following command
.PP
.Vb 7
\&    sh Configure -Dprefix=/opt/perl -Doptimize=-O -Dusethreads \e
\&        -Dcf_by='yourname' \e
\&        -Dcf_email='yourname@yourhost.yourplace.com' \e
\&        -Dperladmin='yourname@yourhost.yourplace.com' \e
\&        -Dmydomain='.yourplace.com' \e
\&        -Dmyhostname='yourhost' \e
\&        -des
.Ve
.Sh "Update Porting/config.sh and Porting/config_H"
[\s-1XXX\s0 
This section needs revision.  We're currently working on easing
the task of keeping the vms, win32, and plan9 config.sh info
up-to-date.  The plan is to use keep up-to-date \*(L'canned\*(R' config.sh
files in the appropriate subdirectories and then generate \*(L'canned\*(R'
config.h files for vms, win32, etc. from the generic config.sh file.
This is to ease maintenance.  When Configure gets updated, the parts
sometimes get scrambled around, and the changes in config_H can
sometimes be very hard to follow.  config.sh, on the other hand, can
safely be sorted, so it's easy to track (typically very small) changes
to config.sh and then propoagate them to a canned \*(L'config.h\*(R' by any
number of means, including a perl script in win32/ or carrying 
config.sh and config_h.\s-1SH\s0 to a Unix system and running sh
config_h.\s-1SH\s0.)
\s-1XXX\s0]
.PP
The Porting/config.sh and Porting/config_H files are provided to
help those folks who can't run Configure.  It is important to keep
them up-to-date.  If you have changed config_h.\s-1SH\s0, those changes must
be reflected in config_H as well.  (The name config_H was chosen to
distinguish the file from config.h even on case-insensitive file systems.)
Simply edit the existing config_H file; keep the first few explanatory
lines and then copy your new config.h below.
.PP
It may also be necessary to update win32/config.?c, vms/config.vms and
plan9/config.plan9, though you should be quite careful in doing so if
you are not familiar with those systems.  You might want to issue your
patch with a promise to quickly issue a follow-up that handles those
directories.
.Sh "make run_byacc"
If you have byacc-1.8.2 (available from \s-1CPAN\s0), and if there have been
changes to \fIperly.y\fR, you can regenerate the \fIperly.c\fR file.  The
run_byacc makefile target does this by running byacc and then applying
some patches so that byacc dynamically allocates space, rather than
having fixed limits.  This patch is handled by the \fIperly.fixer\fR
script.  Depending on the nature of the changes to \fIperly.y\fR, you may
or may not have to hand-edit the patch to apply correctly.  If you do,
you should include the edited patch in the new distribution.  If you
have byacc-1.9, the patch won't apply cleanly.  Changes to the printf
output statements mean the patch won't apply cleanly.  Long ago I
started to fix \fIperly.fixer\fR to detect this, but I never completed the
task.
.PP
Some additional notes from Larry on this:
.PP
Don't forget to regenerate perly_c.diff.
.PP
.Vb 5
\&    byacc -d perly.y
\&    mv y.tab.c perly.c
\&    patch perly.c <perly_c.diff
\&    # manually apply any failed hunks
\&    diff -c2 perly.c.orig perly.c >perly_c.diff
.Ve
One chunk of lines that often fails begins with
.PP
.Vb 1
\&    #line 29 "perly.y"
.Ve
and ends one line before
.PP
.Vb 1
\&    #define YYERRCODE 256
.Ve
This only happens when you add or remove a token type.  I suppose this
could be automated, but it doesn't happen very often nowadays.
.PP
Larry
.Sh "make regen_headers"
The \fIembed.h\fR, \fIkeywords.h\fR, and \fIopcode.h\fR files are all automatically
generated by perl scripts.  Since the user isn't guaranteed to have a
working perl, we can't require the user to generate them.  Hence you have
to, if you're making a distribution.
.PP
I used to include rules like the following in the makefile:
.PP
.Vb 8
\&    # The following three header files are generated automatically
\&    # The correct versions should be already supplied with the perl kit,
\&    # in case you don't have perl or 'sh' available.
\&    # The - is to ignore error return codes in case you have the source
\&    # installed read-only or you don't have perl yet.
\&    keywords.h: keywords.pl
\&            @echo "Don't worry if this fails."
\&            - perl keywords.pl
.Ve
However, I got \fBlots\fR of mail consisting of people worrying because the
command failed.  I eventually decided that I would save myself time
and effort by manually running \f(CWmake regen_headers\fR myself rather
than answering all the questions and complaints about the failing
command.
.Sh "global.sym, interp.sym and perlio.sym"
Make sure these files are up-to-date.  Read the comments in these
files and in perl_exp.\s-1SH\s0 to see what to do.
.Sh "Binary compatibility"
If you do change \fIglobal.sym\fR or \fIinterp.sym\fR, think carefully about
what you are doing.  To the extent reasonable, we'd like to maintain
souce and binary compatibility with older releases of perl.  That way,
extensions built under one version of perl will continue to work with
new versions of perl.
.PP
Of course, some incompatible changes may well be necessary.  I'm just
suggesting that we not make any such changes without thinking carefully
about them first.  If possible, we should provide
backwards-compatibility stubs.  There's a lot of \s-1XS\s0 code out there.
Let's not force people to keep changing it.
.Sh "Changes"
Be sure to update the \fIChanges\fR file.  Try to include both an overall
summary as well as detailed descriptions of the changes.  Your
audience will include other developers and users, so describe
user-visible changes (if any) in terms they will understand, not in
code like \*(L"initialize foo variable in bar function\*(R".
.PP
There are differing opinions on whether the detailed descriptions
ought to go in the Changes file or whether they ought to be available
separately in the patch file (or both).  There is no disagreement that
detailed descriptions ought to be easily available somewhere.
.Sh "Todo"
The \fITodo\fR file contains a roughly-catgorized unordered list of
aspects of Perl that could use enhancement, features that could be
added, areas that could be cleaned up, and so on.  During your term as
pumpkin-holder, you will probably address some of these issues, and
perhaps identify others which, while you decide not to address them
this time around, may be tackled in the future.  Update the file
reflect the situation as it stands when you hand over the pumpkin.
.PP
You might like, early in your pumpkin-holding career, to see if you
can find champions for partiticular issues on the to-do list: an issue
owned is an issue more likely to be resolved.
.PP
There are also some more porting-specific the \fITodo\fR manpage items later in this
file.
.Sh "\s-1OS/2-\s0specific updates"
In the os2 directory is \fIdiff.configure\fR, a set of \s-1OS/2-\s0specific
diffs against \fBConfigure\fR.  If you make changes to Configure, you may
want to consider regenerating this diff file to save trouble for the
\s-1OS/2\s0 maintainer.
.PP
You can also consider the \s-1OS/2\s0 diffs as reminders of portability
things that need to be fixed in Configure.
.Sh "\s-1VMS\s0\-specific updates"
If you have changed \fIperly.y\fR, then you may want to update
\fIvms/perly_{h,c}.vms\fR by running \f(CWperl vms/vms_yfix.pl\fR.
.PP
The Perl version number appears in several places under \fIvms\fR.
It is courteous to update these versions.  For example, if you are
making 5.004_42, replace \*(L"5.00441\*(R" with \*(L"5.00442\*(R".
.Sh "Making the new distribution"
Suppose, for example, that you want to make version 5.004_08.  Then you can
do something like the following
.PP
.Vb 5
\&        mkdir ../perl5.004_08
\&        awk '{print $1}' MANIFEST | cpio -pdm ../perl5.004_08
\&        cd ../
\&        tar cf perl5.004_08.tar perl5.004_08
\&        gzip --best perl5.004_08.tar
.Ve
These steps, with extra checks, are automated by the Porting/makerel
script.
.Sh "Making a new patch"
I find the \fImakepatch\fR utility quite handy for making patches.
You can obtain it from any \s-1CPAN\s0 archive under
http://www.perl.com/\s-1CPAN/\s0authors/Johan_Vromans/ .  There are a couple
of differences between my version and the standard one. I have mine do
a
.PP
.Vb 3
\&        # Print a reassuring "End of Patch" note so people won't
\&        # wonder if their mailer truncated patches.
\&        print "\en\enEnd of Patch.\en";
.Ve
at the end.  That's because I used to get questions from people asking
if their mail was truncated.
.PP
It also writes Index: lines which include the new directory prefix
(change Index: print, approx line 294 or 310 depending on the version,
to read:  print \s-1PATCH\s0 ("Index: \f(CW$newdir\fR$new\en");).  That helps patches
work with more \s-1POSIX\s0 conformant patch programs.
.PP
Here's how I generate a new patch.  I'll use the hypothetical
5.004_07 to 5.004_08 patch as an example.
.PP
.Vb 5
\&        # unpack perl5.004_07/
\&        gzip -d -c perl5.004_07.tar.gz | tar -xof -
\&        # unpack perl5.004_08/
\&        gzip -d -c perl5.004_08.tar.gz | tar -xof -
\&        makepatch perl5.004_07 perl5.004_08 > perl5.004_08.pat
.Ve
Makepatch will automatically generate appropriate \fBrm\fR commands to remove
deleted files.  Unfortunately, it will not correctly set permissions
for newly created files, so you may have to do so manually.  For example,
patch 5.003_04 created a new test \fIt/op/gv.t\fR which needs to be executable,
so at the top of the patch, I inserted the following lines:
.PP
.Vb 3
\&        # Make a new test
\&        touch t/op/gv.t
\&        chmod +x t/opt/gv.t
.Ve
Now, of course, my patch is now wrong because makepatch didn't know I
was going to do that command, and it patched against /dev/null.
.PP
So, what I do is sort out all such shell commands that need to be in the
patch (including possible mv-ing of files, if needed) and put that in the
shell commands at the top of the patch.  Next, I delete all the patch parts
of perl5.004_08.pat, leaving just the shell commands.  Then, I do the
following:
.PP
.Vb 4
\&        cd perl5.004_07
\&        sh ../perl5.004_08.pat
\&        cd ..
\&        makepatch perl5.004_07 perl5.004_08 >> perl5.004_08.pat
.Ve
(Note the append to preserve my shell commands.)
Now, my patch will line up with what the end users are going to do.
.Sh "Testing your patch"
It seems obvious, but be sure to test your patch.  That is, verify that
it produces exactly the same thing as your full distribution.
.PP
.Vb 7
\&        rm -rf perl5.004_07
\&        gzip -d -c perl5.004_07.tar.gz | tar -xf -
\&        cd perl5.004_07
\&        sh ../perl5.004_08.pat
\&        patch -p1 -N < ../perl5.004_08.pat
\&        cd ..
\&        gdiff -r perl5.004_07 perl5.004_08
.Ve
where \fBgdiff\fR is \s-1GNU\s0 diff.  Other diff's may also do recursive checking.
.Sh "More testing"
Again, it's obvious, but you should test your new version as widely as you
can.  You can be sure you'll hear about it quickly if your version doesn't
work on both \s-1ANSI\s0 and pre-\s-1ANSI\s0 compilers, and on common systems such as
SunOS 4.1.[34], Solaris, and Linux.
.PP
If your changes include conditional code, try to test the different
branches as thoroughly as you can.  For example, if your system
supports dynamic loading, you can also test static loading with
.PP
.Vb 1
\&        sh Configure -Uusedl
.Ve
You can also hand-tweak your config.h to try out different #ifdef
branches.
.SH "Common Gotcha's"
.Ip "#elif" 4
The \*(L'#elif\*(R' preprocessor directive is not understood on all systems.
Specifically, I know that Pyramids don't understand it.  Thus instead of the
simple
.Sp
.Vb 7
\&        #if defined(I_FOO)
\&        #  include <foo.h>
\&        #elif defined(I_BAR)
\&        #  include <bar.h>
\&        #else
\&        #  include <fubar.h>
\&        #endif
.Ve
You have to do the more Byzantine
.Sp
.Vb 9
\&        #if defined(I_FOO)
\&        #  include <foo.h>
\&        #else
\&        #  if defined(I_BAR)
\&        #    include <bar.h>
\&        #  else
\&        #    include <fubar.h>
\&        #  endif
\&        #endif
.Ve
Incidentally, whitespace between the leading \*(L'#\*(R' and the preprocessor
command is not guaranteed, but is very portable and you may use it freely.
I think it makes things a bit more readable, especially once things get
rather deeply nested.  I also think that things should almost never get
too deeply nested,  so it ought to be a moot point :\-)
.Ip "Probably Prefer \s-1POSIX\s0" 4
It's often the case that you'll need to choose whether to do
something the \s-1BSD\s0\-ish way or the \s-1POSIX\s0\-ish way.  It's usually not
a big problem when the two systems use different names for similar
functions, such as \fImemcmp()\fR and \fIbcmp()\fR.  The perl.h header file
handles these by appropriate #defines, selecting the \s-1POSIX\s0 mem*()
functions if available, but falling back on the b*() functions, if
need be.
.Sp
More serious is the case where some brilliant person decided to
use the same function name but give it a different meaning or
calling sequence :\-).  \fIgetpgrp()\fR and \fIsetpgrp()\fR come to mind.
These are a real problem on systems that aim for conformance to
one standard (e.g. \s-1POSIX\s0), but still try to support the other way
of doing things (e.g. \s-1BSD\s0).  My general advice (still not really
implemented in the source) is to do something like the following.
Suppose there are two alternative versions, \fIfooPOSIX()\fR and
\fIfooBSD()\fR.
.Sp
.Vb 12
\&    #ifdef HAS_FOOPOSIX
\&        /* use fooPOSIX(); */
\&    #else
\&    #  ifdef HAS_FOOBSD
\&        /* try to emulate fooPOSIX() with fooBSD();
\&           perhaps with the following:  */
\&    #    define fooPOSIX fooBSD
\&    #  else
\&    #  /* Uh, oh.  We have to supply our own. */
\&    #    define fooPOSIX Perl_fooPOSIX
\&    #  endif
\&    #endif
.Ve
.Ip "Think positively" 4
If you need to add an #ifdef test, it is usually easier to follow if you
think positively, e.g.
.Sp
.Vb 5
\&        #ifdef HAS_NEATO_FEATURE
\&            /* use neato feature */
\&        #else
\&            /* use some fallback mechanism */
\&        #endif
.Ve
rather than the more impenetrable
.Sp
.Vb 5
\&        #ifndef MISSING_NEATO_FEATURE
\&            /* Not missing it, so we must have it, so use it */
\&        #else
\&            /* Are missing it, so fall back on something else. */
\&        #endif
.Ve
Of course for this toy example, there's not much difference.  But when
the #ifdef's start spanning a couple of screen fulls, and the #else's
are marked something like
.Sp
.Vb 1
\&        #else /* !MISSING_NEATO_FEATURE */
.Ve
I find it easy to get lost.
.Ip "Providing Missing Functions -- Problem" 4
Not all systems have all the neat functions you might want or need, so
you might decide to be helpful and provide an emulation.  This is
sound in theory and very kind of you, but please be careful about what
you name the function.  Let me use the \f(CWpause()\fR function as an
illustration.
.Sp
Perl5.003 has the following in \fIperl.h\fR
.Sp
.Vb 3
\&    #ifndef HAS_PAUSE
\&    #define pause() sleep((32767<<16)+32767)
\&    #endif
.Ve
Configure sets \s-1HAS_PAUSE\s0 if the system has the \fIpause()\fR function, so
this #define only kicks in if the \fIpause()\fR function is missing.
Nice idea, right?
.Sp
Unfortunately, some systems apparently have a prototype for \fIpause()\fR
in \fIunistd.h\fR, but don't actually have the function in the library.
(Or maybe they do have it in a library we're not using.)
.Sp
Thus, the compiler sees something like
.Sp
.Vb 3
\&    extern int pause(void);
\&    /* . . . */
\&    #define pause() sleep((32767<<16)+32767)
.Ve
and dies with an error message.  (Some compilers don't mind this;
others apparently do.)
.Sp
To work around this, 5.003_03 and later have the following in perl.h:
.Sp
.Vb 9
\&    /* Some unistd.h's give a prototype for pause() even though
\&       HAS_PAUSE ends up undefined.  This causes the #define
\&       below to be rejected by the compiler.  Sigh.
\&    */
\&    #ifdef HAS_PAUSE
\&    #  define Pause     pause
\&    #else
\&    #  define Pause() sleep((32767<<16)+32767)
\&    #endif
.Ve
This works.
.Sp
The curious reader may wonder why I didn't do the following in
\fIutil.c\fR instead:
.Sp
.Vb 6
\&    #ifndef HAS_PAUSE
\&    void pause()
\&    {
\&    sleep((32767<<16)+32767);
\&    }
\&    #endif
.Ve
That is, since the function is missing, just provide it.
Then things would probably be been alright, it would seem.
.Sp
Well, almost.  It could be made to work.  The problem arises from the
conflicting needs of dynamic loading and namespace protection.
.Sp
For dynamic loading to work on \s-1AIX\s0 (and \s-1VMS\s0) we need to provide a list
of symbols to be exported.  This is done by the script \fIperl_exp.\s-1SH\s0\fR,
which reads \fIglobal.sym\fR and \fIinterp.sym\fR.  Thus, the \f(CWpause\fR
symbol would have to be added to \fIglobal.sym\fR  So far, so good.
.Sp
On the other hand, one of the goals of Perl5 is to make it easy to
either extend or embed perl and link it with other libraries.  This
means we have to be careful to keep the visible namespace \*(L"clean\*(R".
That is, we don't want perl's global variables to conflict with
those in the other application library.  Although this work is still
in progress, the way it is currently done is via the \fIembed.h\fR file.
This file is built from the \fIglobal.sym\fR and \fIinterp.sym\fR files,
since those files already list the globally visible symbols.  If we
had added \f(CWpause\fR to global.sym, then \fIembed.h\fR would contain the
line
.Sp
.Vb 1
\&    #define pause       Perl_pause
.Ve
and calls to \f(CWpause\fR in the perl sources would now point to
\f(CWPerl_pause\fR.  Now, when \fBld\fR is run to build the \fIperl\fR executable,
it will go looking for \f(CWperl_pause\fR, which probably won't exist in any
of the standard libraries.  Thus the build of perl will fail.
.Sp
Those systems where \f(CWHAS_PAUSE\fR is not defined would be ok, however,
since they would get a \f(CWPerl_pause\fR function in util.c.  The rest of
the world would be in trouble.
.Sp
And yes, this scenario has happened.  On \s-1SCO\s0, the function \f(CWchsize\fR
is available.  (I think it's in \fI\-lx\fR, the Xenix compatibility
library.)  Since the perl4 days (and possibly before), Perl has
included a \f(CWchsize\fR function that gets called something akin to
.Sp
.Vb 4
\&    #ifndef HAS_CHSIZE
\&    I32 chsize(fd, length)
\&    /*  . . . */
\&    #endif
.Ve
When 5.003 added
.Sp
.Vb 1
\&    #define chsize      Perl_chsize
.Ve
to \fIembed.h\fR, the compile started failing on \s-1SCO\s0 systems.
.Sp
The \*(L"fix\*(R" is to give the function a different name.  The one
implemented in 5.003_05 isn't optimal, but here's what was done:
.Sp
.Vb 6
\&    #ifdef HAS_CHSIZE
\&    # ifdef my_chsize  /* Probably #defined to Perl_my_chsize in embed.h */
\&    #   undef my_chsize
\&    # endif
\&    # define my_chsize chsize
\&    #endif
.Ve
My explanatory comment in patch 5.003_05 said:
.Sp
.Vb 4
\&     Undef and then re-define my_chsize from Perl_my_chsize to
\&     just plain chsize if this system HAS_CHSIZE.  This probably only
\&     applies to SCO.  This shows the perils of having internal
\&     functions with the same name as external library functions :-).
.Ve
Now, we can safely put \f(CWmy_chsize\fR in \fIglobal.sym\fR, export it, and
hide it with \fIembed.h\fR.
.Sp
To be consistent with what I did for \f(CWpause\fR, I probably should have
called the new function \f(CWChsize\fR, rather than \f(CWmy_chsize\fR.
However, the perl sources are quite inconsistent on this (Consider
New, Mymalloc, and Myremalloc, to name just a few.)
.Sp
There is a problem with this fix, however, in that \f(CWPerl_chsize\fR
was available as a \fIlibperl.a\fR library function in 5.003, but it
isn't available any more (as of 5.003_07).  This means that we've
broken binary compatibility.  This is not good.
.Ip "Providing missing functions -- some ideas" 4
We currently don't have a standard way of handling such missing
function names.  Right now, I'm effectively thinking aloud about a
solution.  Some day, I'll try to formally propose a solution.
.Sp
Part of the problem is that we want to have some functions listed as
exported but not have their names mangled by embed.h or possibly
conflict with names in standard system headers.  We actually already
have such a list at the end of \fIperl_exp.\s-1SH\s0\fR (though that list is
out-of-date):
.Sp
.Vb 24
\&    # extra globals not included above.
\&    cat <<END >> perl.exp
\&    perl_init_ext
\&    perl_init_fold
\&    perl_init_i18nl14n
\&    perl_alloc
\&    perl_construct
\&    perl_destruct
\&    perl_free
\&    perl_parse
\&    perl_run
\&    perl_get_sv
\&    perl_get_av
\&    perl_get_hv
\&    perl_get_cv
\&    perl_call_argv
\&    perl_call_pv
\&    perl_call_method
\&    perl_call_sv
\&    perl_requirepv
\&    safecalloc
\&    safemalloc
\&    saferealloc
\&    safefree
.Ve
This still needs much thought, but I'm inclined to think that one
possible solution is to prefix all such functions with \f(CWperl_\fR in the
source and list them along with the other \f(CWperl_*\fR functions in
\fIperl_exp.\s-1SH\s0\fR.
.Sp
Thus, for \f(CWchsize\fR, we'd do something like the following:
.Sp
.Vb 4
\&    /* in perl.h */
\&    #ifdef HAS_CHSIZE
\&    #  define perl_chsize chsize
\&    #endif
.Ve
then in some file (e.g. \fIutil.c\fR or \fIdoio.c\fR) do
.Sp
.Vb 4
\&    #ifndef HAS_CHSIZE
\&    I32 perl_chsize(fd, length)
\&    /* implement the function here . . . */
\&    #endif
.Ve
Alternatively, we could just always use \f(CWchsize\fR everywhere and move
\f(CWchsize\fR from \fIglobal.sym\fR to the end of \fIperl_exp.\s-1SH\s0\fR.  That would
probably be fine as long as our \f(CWchsize\fR function agreed with all the
\f(CWchsize\fR function prototypes in the various systems we'll be using.
As long as the prototypes in actual use don't vary that much, this is
probably a good alternative.  (As a counter-example, note how Configure
and perl have to go through hoops to find and use get Malloc_t and
Free_t for \f(CWmalloc\fR and \f(CWfree\fR.)
.Sp
At the moment, this latter option is what I tend to prefer.
.Ip "All the world's a \s-1VAX\s0" 4
Sorry, showing my age:\-).  Still, all the world is not \s-1BSD\s0 4.[34],
\s-1SVR4\s0, or \s-1POSIX\s0.  Be aware that \s-1SVR3-\s0derived systems are still quite
common (do you have any idea how many systems run \s-1SCO\s0?)  If you don't
have a bunch of v7 manuals handy, the metaconfig units (by default
installed in \fI/usr/local/lib/dist/U\fR) are a good resource to look at
for portability.
.SH "Miscellaneous Topics"
.Sh "Autoconf"
Why does perl use a metaconfig-generated Configure script instead of an
autoconf-generated configure script?
.PP
Metaconfig and autoconf are two tools with very similar purposes.
Metaconfig is actually the older of the two, and was originally written
by Larry Wall, while autoconf is probably now used in a wider variety of
packages.  The autoconf info file discusses the history of autoconf and
how it came to be.  The curious reader is referred there for further
information.
.PP
Overall, both tools are quite good, I think, and the choice of which one
to use could be argued either way.  In March, 1994, when I was just
starting to work on Configure support for Perl5, I considered both
autoconf and metaconfig, and eventually decided to use metaconfig for the
following reasons:
.Ip "Compatibility with Perl4" 4
Perl4 used metaconfig, so many of the #ifdef's were already set up for
metaconfig.  Of course metaconfig had evolved some since Perl4's days,
but not so much that it posed any serious problems.
.Ip "Metaconfig worked for me" 4
My system at the time was Interactive 2.2, a \s-1SVR3\s0.2/386 derivative that
also had some \s-1POSIX\s0 support.  Metaconfig-generated Configure scripts
worked fine for me on that system.  On the other hand, autoconf-generated
scripts usually didn't.  (They did come quite close, though, in some
cases.)  At the time, I actually fetched a large number of \s-1GNU\s0 packages
and checked.  Not a single one configured and compiled correctly
out-of-the-box with the system's cc compiler.
.Ip "Configure can be interactive" 4
With both autoconf and metaconfig, if the script works, everything is
fine.  However, one of my main problems with autoconf-generated scripts
was that if it guessed wrong about something, it could be \fBvery\fR hard to
go back and fix it.  For example, autoconf always insisted on passing the
\-Xp flag to cc (to turn on \s-1POSIX\s0 behavior), even when that wasn't what I
wanted or needed for that package.  There was no way short of editing the
configure script to turn this off.  You couldn't just edit the resulting
Makefile at the end because the \-Xp flag influenced a number of other
configure tests.
.Sp
Metaconfig's Configure scripts, on the other hand, can be interactive.
Thus if Configure is guessing things incorrectly, you can go back and fix
them.  This isn't as important now as it was when we were actively
developing Configure support for new features such as dynamic loading,
but it's still useful occasionally.
.Ip "\s-1GPL\s0" 4
At the time, autoconf-generated scripts were covered under the \s-1GNU\s0 Public
License, and hence weren't suitable for inclusion with Perl, which has a
different licensing policy.  (Autoconf's licensing has since changed.)
.Ip "Modularity" 4
Metaconfig builds up Configure from a collection of discrete pieces
called \*(L"units\*(R".  You can override the standard behavior by supplying your
own unit.  With autoconf, you have to patch the standard files instead.
I find the metaconfig \*(L"unit\*(R" method easier to work with.  Others
may find metaconfig's units clumsy to work with.
.Sh "\f(CW@INC\fR search order"
By default, the list of perl library directories in \f(CW@INC\fR is the
following:
.PP
.Vb 4
\&    $archlib
\&    $privlib
\&    $sitearch
\&    $sitelib
.Ve
Specifically, on my Solaris/x86 system, I run
\fBsh Configure \-Dprefix=/opt/perl\fR and I have the following
directories:
.PP
.Vb 4
\&    /opt/perl/lib/i86pc-solaris/5.00307
\&    /opt/perl/lib
\&    /opt/perl/lib/site_perl/i86pc-solaris
\&    /opt/perl/lib/site_perl
.Ve
That is, perl's directories come first, followed by the site-specific
directories.
.PP
The site libraries come second to support the usage of extensions
across perl versions.  Read the relevant section in \fI\s-1INSTALL\s0\fR for
more information.  If we ever make \f(CW$sitearch\fR version-specific, this
topic could be revisited.
.Sh "Why isn't there a directory to override Perl's library?"
Mainly because no one's gotten around to making one.  Note that
\*(L"making one\*(R"  involves changing perl.c, Configure, config_h.\s-1SH\s0 (and
associated files, see above), and \fIdocumenting\fR it all in the
\s-1INSTALL\s0 file.
.PP
Apparently, most folks who want to override one of the standard library
files simply do it by overwriting the standard library files.
.Sh "\s-1APPLLIB\s0"
In the perl.c sources, you'll find an undocumented \s-1APPLLIB_EXP\s0
variable, sort of like \s-1PRIVLIB_EXP\s0 and \s-1ARCHLIB_EXP\s0 (which are
documented in config_h.\s-1SH\s0).  Here's what \s-1APPLLIB_EXP\s0 is for, from
a mail message from Larry:
.PP
.Vb 6
\&    The main intent of APPLLIB_EXP is for folks who want to send out a
\&    version of Perl embedded in their product.  They would set the symbol
\&    to be the name of the library containing the files needed to run or to
\&    support their particular application.  This works at the "override"
\&    level to make sure they get their own versions of any library code that
\&    they absolutely must have configuration control over.
.Ve
.Vb 4
\&    As such, I don't see any conflict with a sysadmin using it for a
\&    override-ish sort of thing, when installing a generic Perl.  It should
\&    probably have been named something to do with overriding though.  Since
\&    it's undocumented we could still change it...  :-)
.Ve
Given that it's already there, you can use it to override
distribution modules.  If you do
.PP
.Vb 1
\&        sh Configure -Dccflags='-DAPPLLIB_EXP=/my/override'
.Ve
then perl.c will put /my/override ahead of \s-1ARCHLIB\s0 and \s-1PRIVLIB\s0.
.Sh "Shared libperl.so location"
Why isn't the shared libperl.so installed in /usr/lib/ along
with \*(L"all the other\*(R" shared libraries?  Instead, it is installed
in \f(CW$archlib\fR, which is typically something like
.PP
.Vb 1
\&        /usr/local/lib/perl5/archname/5.00404
.Ve
and is architecture- and version-specific.
.PP
The basic reason why a shared libperl.so gets put in \f(CW$archlib\fR is so that
you can have more than one version of perl on the system at the same time,
and have each refer to its own libperl.so.
.PP
Three examples might help.  All of these work now; none would work if you
put libperl.so in /usr/lib.
.Ip "1." 5
Suppose you want to have both threaded and non-threaded perl versions
around.  Configure will name both perl libraries \*(L"libperl.so\*(R" (so that
you can link to them with \-lperl).  The perl binaries tell them apart
by having looking in the appropriate \f(CW$archlib\fR directories.
.Ip "2." 5
Suppose you have perl5.004_04 installed and you want to try to compile
it again, perhaps with different options or after applying a patch.
If you already have libperl.so installed in /usr/lib/, then it may be
either difficult or impossible to get ld.so to find the new libperl.so
that you're trying to build.  If, instead, libperl.so is tucked away in
\f(CW$archlib\fR, then you can always just change \f(CW$archlib\fR in the current perl
you're trying to build so that ld.so won't find your old libperl.so.
(The \s-1INSTALL\s0 file suggests you do this when building a debugging perl.)
.Ip "3." 5
The shared perl library is not a \*(L"well-behaved\*(R" shared library with
proper major and minor version numbers, so you can't necessarily
have perl5.004_04 and perl5.004_05 installed simultaneously.  Suppose
perl5.004_04 were to install /usr/lib/libperl.so.4.4, and perl5.004_05
were to install /usr/lib/libperl.so.4.5.  Now, when you try to run
perl5.004_04, ld.so might try to load libperl.so.4.5, since it has
the right \*(L"major version\*(R" number.  If this works at all, it almost
certainly defeats the reason for keeping perl5.004_04 around.  Worse,
with development subversions, you certaily can't guarantee that
libperl.so.4.4 and libperl.so.4.55 will be compatible.
.Sp
Anyway, all this leads to quite obscure failures that are sure to drive
casual users crazy.  Even experienced users will get confused :\-).  Upon
reflection, I'd say leave libperl.so in \f(CW$archlib\fR.
.SH "Upload Your Work to CPAN"
You can upload your work to CPAN if you have a CPAN id.  Check out
http://www.perl.com/CPAN/modules/04pause.html for information on
_PAUSE_, the Perl Author's Upload Server.
.PP
I typically upload both the patch file, e.g. \fIperl5.004_08.pat.gz\fR
and the full tar file, e.g. \fIperl5.004_08.tar.gz\fR.
.PP
If you want your patch to appear in the \fIsrc/5.0/unsupported\fR
directory on CPAN, send e-mail to the CPAN master librarian.  (Check
out http://www.perl.com/CPAN/CPAN.html ).
.SH "Help Save the World"
You should definitely announce your patch on the perl5-porters list.
You should also consider announcing your patch on
comp.lang.perl.announce, though you should make it quite clear that a
subversion is not a production release, and be prepared to deal with
people who will not read your disclaimer.
.SH "Todo"
Here, in no particular order, are some Configure and build-related
items that merit consideration.  This list isn't exhaustive, it's just
what I came up with off the top of my head.
.Sh "Good ideas waiting for round tuits"
.Ip "installprefix" 4
I think we ought to support
.Sp
.Vb 1
\&    Configure -Dinstallprefix=/blah/blah
.Ve
Currently, we support \fB\-Dprefix=/blah/blah\fR, but the changing the install
location has to be handled by something like the \fIconfig.over\fR trick
described in \fI\s-1INSTALL\s0\fR.  \s-1AFS\s0 users also are treated specially.
We should probably duplicate the metaconfig prefix stuff for an
install prefix.
.Ip "Configure \-Dsrc=/blah/blah" 4
We should be able to emulate \fBconfigure --srcdir\fR.  Tom Tromey
tromey@creche.cygnus.com has submitted some patches to
the dist-users mailing list along these lines.  They have been folded
back into the main distribution, but various parts of the perl
Configure/build/install process still assume src=\*(R'.\*(R'.
.Ip "Hint file fixes" 4
Various hint files work around Configure problems.  We ought to fix
Configure so that most of them aren't needed.
.Ip "Hint file information" 4
Some of the hint file information (particularly dynamic loading stuff)
ought to be fed back into the main metaconfig distribution.
.Ip "Catch \s-1GNU\s0 Libc \*(N"Stub\*(T" functions" 4
Some functions (such as \fIlchown()\fR) are present in libc, but are
unimplmented.  That is, they always fail and set errno=\s-1ENOSYS\s0.
.Sp
Thomas Bushnell provided the following sample code and the explanation
that follows:
.Sp
.Vb 7
\&    /* System header to define __stub macros and hopefully few prototypes,
\&        which can conflict with char FOO(); below.  */
\&    #include <assert.h>
\&    /* Override any gcc2 internal prototype to avoid an error.  */
\&    /* We use char because int might match the return type of a gcc2
\&        builtin and then its argument prototype would still apply.  */
\&    char FOO();
.Ve
.Vb 1
\&    int main() {
.Ve
.Vb 8
\&    /* The GNU C library defines this for functions which it implements
\&        to always fail with ENOSYS.  Some functions are actually named
\&        something starting with __ and the normal name is an alias.  */
\&    #if defined (__stub_FOO) || defined (__stub___FOO)
\&    choke me
\&    #else
\&    FOO();
\&    #endif
.Ve
.Vb 1
\&    ; return 0; }
.Ve
The choice of <assert.h> is essentially arbitrary.  The \s-1GNU\s0 libc
macros are found in <gnu/stubs.h>.  You can include that file instead
of <assert.h> (which itself includes <gnu/stubs.h>) if you test for
its existence first.  <assert.h> is assumed to exist on every system,
which is why it's used here.  Any \s-1GNU\s0 libc header file will include
the stubs macros.  If either _\|_stub_NAME or _\|_stub_\|__NAME is defined,
then the function doesn't actually exist.  Tests using <assert.h> work
on every system around.
.Sp
The declaration of \s-1FOO\s0 is there to override builtin prototypes for
\s-1ANSI\s0 C functions.
.Sh "Probably good ideas waiting for round tuits"
.Ip "\s-1GNU\s0 configure --options" 4
I've received sensible suggestions for --exec_prefix and other
\s-1GNU\s0 configure --options.  It's not always obvious exactly what is
intended, but this merits investigation.
.Ip "make clean" 4
Currently, \fBmake clean\fR isn't all that useful, though
\fBmake realclean\fR and \fBmake distclean\fR are.  This needs a bit of
thought and documentation before it gets cleaned up.
.Ip "Try gcc if cc fails" 4
Currently, we just give up.
.Ip "bypassing safe*alloc wrappers" 4
On some systems, it may be safe to call the system malloc directly
without going through the util.c safe* layers.  (Such systems would
accept \fIfree\fR\|(0), for example.)  This might be a time-saver for systems
that already have a good malloc.  (Recent Linux libc's apparently have
a nice malloc that is well-tuned for the system.)
.Sh "Vague possibilities"
.Ip "MacPerl" 4
Get some of the Macintosh stuff folded back into the main distribution.
.Ip "gconvert replacement" 4
Maybe include a replacement function that doesn't lose data in rare
cases of coercion between string and numerical values.
.Ip "Improve makedepend" 4
The current makedepend process is clunky and annoyingly slow, but it
works for most folks.  Alas, it assumes that there is a filename
\f(CW$firstmakefile\fR that the \fBmake\fR command will try to use before it uses
\fIMakefile\fR.  Such may not be the case for all \fBmake\fR commands,
particularly those on non-Unix systems.
.Sp
Probably some variant of the \s-1BSD\s0 \fI.depend\fR file will be useful.
We ought to check how other packages do this, if they do it at all.
We could probably pre-generate the dependencies (with the exception of
malloc.o, which could probably be determined at \fIMakefile.\s-1SH\s0\fR
extraction time.
.Ip "\s-1GNU\s0 Makefile standard targets" 4
\s-1GNU\s0 software generally has standardized Makefile targets.  Unless we
have good reason to do otherwise, I see no reason not to support them.
.Ip "File locking" 4
Somehow, straighten out, document, and implement \fIlockf()\fR, \fIflock()\fR,
and/or \fIfcntl()\fR file locking.  It's a mess.
.SH "AUTHORS"
Original author:  Andy Dougherty doughera@lafcol.lafayette.edu .
Additions by Chip Salzenberg chip@perl.com and 
Tim Bunce Tim.Bunce@ig.co.uk .
.PP
All opinions expressed herein are those of the author\&(s).
.SH "LAST MODIFIED"
$Id: pumpkin.pod,v 1.22 1998/07/22 16:33:55 doughera Released $

.rn }` ''
.IX Title "PUMPKIN 1"
.IX Name "Pumpkin - Notes on handling the Perl Patch Pumpkin"

.IX Header "NAME"

.IX Header "SYNOPSIS"

.IX Header "DESCRIPTION"

.IX Header "Where Do I Get Perl Sources and Related Material?"

.IX Subsection "Perl5-porters mailing list"

.IX Header "How are Perl Releases Numbered?"

.IX Subsection "Subversions"

.IX Subsection "Maintenance and Development Subversions"

.IX Subsection "Why such a complicated scheme?"

.IX Subsection "Why is it called the patch pumpkin?"

.IX Header "Philosophical Issues in Patching Perl"

.IX Subsection "Solve problems as generally as possible"

.IX Subsection "Seek consensus on major changes"

.IX Subsection "Keep the documentation up-to-date"

.IX Subsection "Avoid machine-specific #ifdef's"

.IX Subsection "Allow for lots of testing"

.IX Subsection "Test popular applications and modules."

.IX Subsection "Automate generation of derivative files"

.IX Header "How to Make a Distribution"

.IX Subsection "Announce your intentions"

.IX Subsection "refresh pod/perltoc.pod"

.IX Subsection "run installhtml to check the validity of the pod files"

.IX Subsection "update patchlevel.h"

.IX Subsection "run metaconfig"

.IX Subsection "\s-1MANIFEST\s0"

.IX Subsection "Check permissions"

.IX Subsection "Run Configure"

.IX Subsection "Update Porting/config.sh and Porting/config_H"

.IX Subsection "make run_byacc"

.IX Subsection "make regen_headers"

.IX Subsection "global.sym, interp.sym and perlio.sym"

.IX Subsection "Binary compatibility"

.IX Subsection "Changes"

.IX Subsection "Todo"

.IX Subsection "\s-1OS/2-\s0specific updates"

.IX Subsection "\s-1VMS\s0\-specific updates"

.IX Subsection "Making the new distribution"

.IX Subsection "Making a new patch"

.IX Subsection "Testing your patch"

.IX Subsection "More testing"

.IX Header "Common Gotcha's"

.IX Item "#elif"

.IX Item "Probably Prefer \s-1POSIX\s0"

.IX Item "Think positively"

.IX Item "Providing Missing Functions -- Problem"

.IX Item "Providing missing functions -- some ideas"

.IX Item "All the world's a \s-1VAX\s0"

.IX Header "Miscellaneous Topics"

.IX Subsection "Autoconf"

.IX Item "Compatibility with Perl4"

.IX Item "Metaconfig worked for me"

.IX Item "Configure can be interactive"

.IX Item "\s-1GPL\s0"

.IX Item "Modularity"

.IX Subsection "\f(CW@INC\fR search order"

.IX Subsection "Why isn't there a directory to override Perl's library?"

.IX Subsection "\s-1APPLLIB\s0"

.IX Subsection "Shared libperl.so location"

.IX Item "1."

.IX Item "2."

.IX Item "3."

.IX Header "Upload Your Work to CPAN"

.IX Header "Help Save the World"

.IX Header "Todo"

.IX Subsection "Good ideas waiting for round tuits"

.IX Item "installprefix"

.IX Item "Configure \-Dsrc=/blah/blah"

.IX Item "Hint file fixes"

.IX Item "Hint file information"

.IX Item "Catch \s-1GNU\s0 Libc \*(N"Stub\*(T" functions"

.IX Subsection "Probably good ideas waiting for round tuits"

.IX Item "\s-1GNU\s0 configure --options"

.IX Item "make clean"

.IX Item "Try gcc if cc fails"

.IX Item "bypassing safe*alloc wrappers"

.IX Subsection "Vague possibilities"

.IX Item "MacPerl"

.IX Item "gconvert replacement"

.IX Item "Improve makedepend"

.IX Item "\s-1GNU\s0 Makefile standard targets"

.IX Item "File locking"

.IX Header "AUTHORS"

.IX Header "LAST MODIFIED"

